(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{18:function(e,t,n){e.exports=n(37)},24:function(e,t,n){},25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(0),l=n.n(a),r=n(14),i=n.n(r),c=(n(24),n(5)),o=n(6),s=n(8),u=n(7),m=n(9),d=n(39),E=n(41),h=n(38),f=n(16),v=(n(25),l.a.createContext({token:null,userId:null,login:function(e,t,n){},logout:function(){}})),p=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={isLogin:!0},n.switchModelHandler=function(){n.setState(function(e){return{isLogin:!e.isLogin}})},n.submitHandler=function(e){e.preventDefault();var t=n.emailEl.current.value,a=n.passwordEl.current.value;if(0!==t.trim().length&&0!==a.trim().length){var l={query:'\n        query {\n          login(email: "'.concat(t,'", password: "').concat(a,'") {\n            userId\n            token\n            tokenExpiration\n          }\n        }\n      ')};n.state.isLogin||(l={query:'\n          mutation {\n            createUser(userInput: {email: "'.concat(t,'", password: "').concat(a,'"}) {\n              _id\n              email\n            }\n          }\n        ')}),fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json"}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()}).then(function(e){console.log(e),e.data.login.token&&n.context.login(e.data.login.token,e.data.login.userId,e.data.login.tokenExpiration)}).catch(function(e){console.log(e)})}},n.emailEl=l.a.createRef(),n.passwordEl=l.a.createRef(),n}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return l.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},l.a.createElement("div",{className:"form-control"},l.a.createElement("label",{htmlFor:"email"},"E-Mail"),l.a.createElement("input",{type:"email",id:"email",ref:this.emailEl})),l.a.createElement("div",{className:"form-control"},l.a.createElement("label",{htmlFor:"password"},"Password"),l.a.createElement("input",{type:"password",id:"password",ref:this.passwordEl})),l.a.createElement("div",{className:"form-actions"},l.a.createElement("button",{type:"submit"},"Submit"),l.a.createElement("button",{type:"button",onClick:this.switchModelHandler},"Switch to ",this.state.isLogin?"Signup":"Login")))}}]),t}(a.Component);p.contextType=v;var g=p,b=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return l.a.createElement("h1",null,"The Bookings Page")}}]),t}(a.Component),k=n(15),y=(n(26),function(e){return l.a.createElement("div",{className:"backdrop"})}),C=(n(27),function(e){return l.a.createElement("div",{className:"model"},l.a.createElement("header",{className:"model__header"},l.a.createElement("h1",null,e.title)),l.a.createElement("section",{className:"model__content"},e.children),l.a.createElement("section",{className:"model__actions"},e.canCancel&&l.a.createElement("button",{className:"btn",onClick:e.onCancel},"Cancel"),e.canConfirm&&l.a.createElement("button",{className:"btn",onClick:e.onConfirm},e.confirmText)))}),w=(n(28),function(e){return l.a.createElement("li",{key:e.eventId,className:"events__list-item"},l.a.createElement("div",null,l.a.createElement("h1",null,e.title),l.a.createElement("h2",null,"$",e.price," - ",new Date(e.date).toLocaleDateString())),l.a.createElement("div",null,e.userId===e.creatorId?l.a.createElement("p",null,"Your the owner of this event."):l.a.createElement("button",{className:"btn",onClick:e.onDetail.bind(void 0,e.eventId)},"View Details")))}),N=(n(29),function(e){var t=e.events.map(function(t){return l.a.createElement(w,{key:t._id,eventId:t._id,title:t.title,price:t.price,date:t.date,userId:e.authuserId,creatorId:t.creator._id,onDetail:e.onViewDetail})});return l.a.createElement("ul",{className:"event__list"},t)}),j=(n(30),function(){return l.a.createElement("div",{className:"spinner"},l.a.createElement("div",{className:"lds-dual-ring"}))}),O=(n(31),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={creating:!1,events:[],isLoading:!1,selectedEvent:null},n.startCreateEventHandler=function(){n.setState({creating:!0})},n.modelConfirmHandler=function(){n.setState({creating:!1});var e=n.titleElRef.current.value,t=+n.priceElRef.current.value,a=n.dateElRef.current.value,l=n.descriptionElRef.current.value;if(!(0===e.trim().length||t<=0||0===a.trim().length||0===l.trim().length)){var r={title:e,price:t,date:a,description:l};console.log(r);var i={query:'\n        mutation {\n          createEvent(eventInput: {title: "'.concat(e,'", description: "').concat(l,'", price: ').concat(t,', date: "').concat(a,'"}) {\n            _id\n            title\n            description\n            date\n            price\n          }\n        }\n      ')},c=n.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",Authorization:"Bearer "+c}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()}).then(function(e){n.setState(function(t){var a=Object(k.a)(t.events);return a.push({_id:e.data.createEvent._id,title:e.data.createEvent.title,description:e.data.createEvent.description,date:e.data.createEvent.date,price:e.data.createEvent.price,creator:{_id:n.context.userId}}),{events:a}})}).catch(function(e){console.log(e)})}},n.modelCancelHandler=function(){n.setState({creating:!1,selectedEvent:null})},n.showDetailHandler=function(e){n.setState(function(t){return{selectedEvent:t.events.find(function(t){return t._id===e})}})},n.bookEventhandler=function(){},n.titleElRef=l.a.createRef(),n.priceElRef=l.a.createRef(),n.dateElRef=l.a.createRef(),n.descriptionElRef=l.a.createRef(),n}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var e=this;this.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n        query {\n          events {\n            _id\n            title\n            description\n            date\n            price\n            creator {\n              _id\n              email\n            }\n          }\n        }\n      "}),headers:{"Content-Type":"application/json"}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()}).then(function(t){var n=t.data.events;e.setState({events:n,isLoading:!1})}).catch(function(t){console.log(t),e.setState({isLoading:!1})})}},{key:"render",value:function(){return l.a.createElement(l.a.Fragment,null,(this.state.creating||this.state.selectedEvent)&&l.a.createElement(y,null),this.state.creating&&l.a.createElement(C,{title:"Add Event",canCancel:!0,canConfirm:!0,onCancel:this.modelCancelHandler,onConfirm:this.modelConfirmHandler,confirmText:"Confirm"},l.a.createElement("form",null,l.a.createElement("div",{className:"form-control"},l.a.createElement("label",{htmlFor:"title"},"Title"),l.a.createElement("input",{type:"text",id:"title",ref:this.titleElRef})),l.a.createElement("div",{className:"form-control"},l.a.createElement("label",{htmlFor:"price"},"Price"),l.a.createElement("input",{type:"number",id:"price",ref:this.priceElRef})),l.a.createElement("div",{className:"form-control"},l.a.createElement("label",{htmlFor:"date"},"Date"),l.a.createElement("input",{type:"datetime-local",id:"date",ref:this.dateElRef})),l.a.createElement("div",{className:"form-control"},l.a.createElement("label",{htmlFor:"description"},"Description"),l.a.createElement("textarea",{id:"description",rows:"4",ref:this.descriptionElRef})))),this.state.selectedEvent&&l.a.createElement(C,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modelCancelHandler,onConfirm:this.bookEventhandler,confirmText:"Book"},l.a.createElement("h1",null,this.state.selectedEvent.title),l.a.createElement("h2",null,"$",this.state.selectedEvent.price," -"," ",new Date(this.state.selectedEvent.date).toLocaleDateString()),l.a.createElement("p",null,this.state.selectedEvent.description)),this.context.token&&l.a.createElement("div",{className:"events-control"},l.a.createElement("p",null,"Share your own Events!"),l.a.createElement("button",{className:"btn",onClick:this.startCreateEventHandler},"Create Event")),this.state.isLoading?l.a.createElement(j,null):l.a.createElement(N,{events:this.state.events,authuserId:this.context.userId,onViewDetail:this.showDetailHandler}))}}]),t}(a.Component));O.contextType=v;var _=O,S=n(40),I=(n(32),function(e){return l.a.createElement(v.Consumer,null,function(e){return l.a.createElement("header",{className:"main-navigation"},l.a.createElement("div",{className:"main-navigation__logo"},l.a.createElement("h1",null,"EasyEvent")),l.a.createElement("nav",{className:"main-navigation__items"},l.a.createElement("ul",null,!e.token&&l.a.createElement("li",null,l.a.createElement(S.a,{to:"/auth"},"Authenticate")),l.a.createElement("li",null,l.a.createElement(S.a,{to:"/events"},"Events")),e.token&&l.a.createElement(l.a.Fragment,null,l.a.createElement("li",null,l.a.createElement(S.a,{to:"/bookings"},"Bookings")),l.a.createElement("li",null,l.a.createElement("button",{onClick:e.logout},"Logout"))))))})}),x=(n(36),function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,l=new Array(a),r=0;r<a;r++)l[r]=arguments[r];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(l)))).state={token:null,userId:null},n.login=function(e,t,a){n.setState({token:e,userId:t})},n.logout=function(){n.setState({token:null,userId:null})},n}return Object(m.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return l.a.createElement(d.a,null,l.a.createElement(l.a.Fragment,null,l.a.createElement(v.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout}},l.a.createElement(I,null),l.a.createElement("main",{className:"main-content"},l.a.createElement(E.a,null,this.state.token&&l.a.createElement(h.a,{from:"/",to:"/events",exact:!0}),this.state.token&&l.a.createElement(h.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&l.a.createElement(f.a,{path:"/auth",component:g}),l.a.createElement(f.a,{path:"/events",component:_}),this.state.token&&l.a.createElement(f.a,{path:"/bookings",component:b}),!this.state.token&&l.a.createElement(h.a,{to:"/auth",exact:!0}))))))}}]),t}(a.Component));i.a.render(l.a.createElement(x,null),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.fad49948.chunk.js.map